<mxfile host="app.diagrams.net" modified="2023-08-10T02:20:28.611Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36 Edg/115.0.1901.188" etag="npbWu8CVldxq16eXjhuD" version="21.6.7" type="github">
  <diagram name="페이지-1" id="XCwguPV3iCqasTkN0QVd">
    <mxGraphModel dx="2206" dy="796" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="TrRbaetDsdgHLVqCblbi-3" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#007fff&quot;&gt;&lt;b&gt;apps_kwd_task&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(apps_kwd.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 기동어 인식을 위한 엔진 함수&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 기동어 인식 시 호출되는 callback 함수 정의 (&lt;b&gt;CB_onDetected&lt;/b&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 무한루프를 돌면서 768byte씩 ring buffer로부터 음성 녹음을 읽고 pcm_buffer라는 array에 저장&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;어떻게 꺼지는지도 확인해봐야겠다&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="1" vertex="1">
          <mxGeometry x="-250" y="60" width="290" height="150" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-5" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;makeDecisionLNE&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(KWS_DNN_Decoder.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 음성 energy score를 통해 기동어가 맞는지 판단&amp;nbsp;&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="1" vertex="1">
          <mxGeometry x="580" y="105" width="230" height="90" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-10" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;CB_onDetected&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(apps_kwd.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 기동어 녹음 길이를 알려주는 epd_skip_byte 지정&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- Modem에게 FID_EPD_SKIP_BYPTES로 epd_skip_bytes 정보 전달&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- Modem에게 FID_ACTIVE_MIC_STATUS로 멀티턴 정보 전달 ( 처음에는 무조건 0)&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- APPS_VR_MANAGER_TASK에게 eVR_MANAGER_WAKEUP_DONE를 보냄&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- seamless를 위한 timer 실행&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="1" vertex="1">
          <mxGeometry x="260" y="280" width="520" height="170" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-11" value="" style="group" parent="1" vertex="1" connectable="0">
          <mxGeometry x="190" y="50" width="260" height="200" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-8" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;Process_Wakeup&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(HATWDengineCore.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;fillColor=default;" parent="TrRbaetDsdgHLVqCblbi-11" vertex="1">
          <mxGeometry width="260" height="200" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-4" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- pcm 파일에서 mfcc 추출&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- mfcc에서 energy score를 판단&amp;nbsp;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="TrRbaetDsdgHLVqCblbi-11" vertex="1">
          <mxGeometry x="10" y="50" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-9" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 기동어 인식이라고 판단되면 &lt;b&gt;CB_onDetected&lt;/b&gt; 함수 실행&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="TrRbaetDsdgHLVqCblbi-11" vertex="1">
          <mxGeometry x="10" y="124" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-12" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="50" y="120" as="sourcePoint" />
            <mxPoint x="180" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-13" value="pcm_buffer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="73" y="88" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-16" value="" style="endArrow=classic;html=1;rounded=0;entryX=-0.035;entryY=0.333;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="114.5" as="sourcePoint" />
            <mxPoint x="571.9499999999998" y="114.97000000000003" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-17" value="음성 에너지 점수" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="460" y="80" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-18" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="570" y="194" as="sourcePoint" />
            <mxPoint x="465" y="194" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-19" value="&lt;b&gt;결과&lt;br&gt;&lt;/b&gt;1 : 인식&lt;br&gt;0 : 보류&lt;br&gt;-1: 미인식" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="490" y="194" width="60" height="66" as="geometry" />
        </mxCell>
        <mxCell id="TrRbaetDsdgHLVqCblbi-20" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;APPS_VR_MANAGER_TASK&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(service_vr_manager.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- DQC에서 다음 실행할 동작을 제어해주는 handler thread&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- 무한 루프를 돌면서 msg를 받으면 그것을 바로 case 마다 처리&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" parent="1" vertex="1">
          <mxGeometry x="250" y="530" width="501" height="460" as="geometry" />
        </mxCell>
        <mxCell id="sXWmz9hjVyttIy2R4i8F-1" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#007fff&quot;&gt;Send_message_to_vr_manager&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cccc00&quot;&gt;(service_vr_manager.c)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- main vr_manager task에게 다음 실행해야 할 부분을 message 형태로 가공해서 보내주는 함수&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- SendMsg(&lt;b&gt;APPS_VR_MANAGER_TASK_ID&lt;/b&gt;, &amp;amp;message)로 전송&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" vertex="1" parent="1">
          <mxGeometry x="-230" y="410" width="390" height="100" as="geometry" />
        </mxCell>
        <mxCell id="sXWmz9hjVyttIy2R4i8F-2" value="&lt;div style=&quot;&quot;&gt;case eVR_MANAGER_WAKEUP_DONE&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- mfcc에서 energy score를 판단&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;- &lt;b&gt;wifi 가 연결 되어있다면:&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;1.&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;APPS_VR_MANAGER_TASK에게 eVR_VOICE_FEEDBACK_LED를 보내서 인식 성공을 위한 led 제어&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;2.&amp;nbsp;APPS_VR_MANAGER_TASK에게 eVR_MANAGER_ACTIVATE_ASR_THREAD를 보내서 asr 실행&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;- wifi 가 연결되어있지 않다면:&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;&lt;/div&gt;&lt;div style=&quot;border-color: var(--border-color);&quot;&gt;1.&amp;nbsp;APPS_VR_MANAGER_TASK에게 eVR_VOICE_FEEDBACK_LED를 보내서 와이파이 에러를 위한 led 제어&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;border-color: var(--border-color); background-color: initial;&quot;&gt;2. 네트워크 에러 음성 파일을 playlist queue에 넣는다&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;labelPosition=center;verticalLabelPosition=middle;verticalAlign=top;spacingRight=0;spacingLeft=2;" vertex="1" parent="1">
          <mxGeometry x="261" y="620" width="480" height="220" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
